<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quay Repositories :: Red Hat Quay Workshop</title>
    <link rel="canonical" href="https://olleb.com/quay-workshop/quay-repos.html">
    <link rel="prev" href="quay-orgs.html">
    <link rel="next" href="quay-mirror.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/quay-workshop">Red Hat Quay Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="v3.7">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#tools">1.1. Container Management Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html#quay">1.2. Red Hat Quay Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#odf">1.2.1. ODF operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#storage">1.2.2. Creating the standalone object gateway</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#quayoperator">1.2.3. Installing Quay operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#quayinstance">1.2.4. Deploying Quay</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#exportenvvar">1.2.5. Export environment variables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">2. Red Hat Quay</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-orgs.html">2.1 Users and Organizations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-orgs.html#useraccounts">2.1.1 Creating user accounts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-orgs.html#orgaccounts">2.1.2 Creating organization accounts</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-repos.html">2.2 Quay Repositories</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#imagerepo">2.2.1 Creating an image repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#push">2.2.2 Push (and tag) an image into the repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#imglayers">2.2.3 Inspecting image layers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pull">2.2.4 Pull an image from the repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#rollback">2.2.5 Image rollback</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#expiration">2.2.6 Image expiration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-mirror.html">2.3 Quay Repository Mirroring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-mirror.html#imagerepo">2.3.1 Creating a repository to mirror from</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-mirror.html#usage">2.3.1.2 Repository usage logs, tags and tag history</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-repo-notifications.html">2.4 Quay Repository Notifications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-repo-notifications.html#pushnotif">2.4.1 Creating a push to repository event notification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html">2.5 Quay OCI-based Artifacts Repository</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#allowed">2.5.1 Configuring allowed OCI artifact types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#helm">2.5.2 Helm charts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html#signed">2.5.3 Signed container images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-oci.html#cosign">2.5.3.1 Signed container images with cosign</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-oci.html#signpgp">2.5.3.2 Signed container images with PGP (RFC4880)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html#encrypted">2.5.4 Encrypted container images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-oci.html#jwe">2.5.4.1 Encrypted container images with JSON Web Encryption (JWE) (RFC7516)</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-oci.html#pgp">2.5.4.2 Encrypted container images with PGP (RFC4880)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-clair.html">2.6 Clair Security Scanning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-clair.html#cve">2.6.1 Explore the vulnerability data (CVE&#8217;s)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-clair.html#secscan">2.6.1.1 Security scan</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="quay-clair.html#packages">2.6.1.2 Packages</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-cso.html">2.7 Quay Container Security Operator (CSO)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-cso.html#install">2.7.1 Installing the Quay CSO Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-cso.html#vulncheck">2.7.2 Checking the image vulnerabilities through the OpenShift web console</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-obs.html">2.8 Quay Observability</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Quay Workshop</a></li>
    <li>2. Red Hat Quay</li>
    <li><a href="quay-repos.html">2.2 Quay Repositories</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v3.7</button>
  <div class="version-menu">
    <a class="version" href="../quay-repos.html">main</a>
    <a class="version is-current" href="quay-repos.html">v3.7</a>
  </div>
</div>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://olleb.com" target="_blank" rel="noopener noreferrer"> © 2023 - Àngel Ollé Blázquez</a></div>
</div>
 
  <div class="content">
<article class="doc">
<h1 class="page">Quay Repositories</h1>
<div class="sect1">
<h2 id="imagerepo"><a class="anchor" href="#imagerepo"></a>Creating an image repository</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Click on the <code>Create New Repository</code> button.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/create-repo.png" alt="create repo">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the organization from the drop-down list, name the repository <code>kafka</code>, and set the visibility to <code>Public</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/repo-config.png" alt="repo config">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Create Public Repository</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="push"><a class="anchor" href="#push"></a>Push (and tag) an image into the repository</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Pull an image from the public registry by running the <code>podman pull</code> command followed by the name of the image.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman pull quay.io/strimzi/kafka:latest-kafka-3.1.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tag the image with a name and a version number using the <code>podman tag</code> command.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman tag quay.io/strimzi/kafka:latest-kafka-3.1.0 ${QUAY_HOSTNAME}/olleb/kafka:3.1.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sign into our Quay repository using your account credentials, if you are not already signed in.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman login ${QUAY_HOSTNAME}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Push the image to the Quay repository using the <code>podman push</code> command.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">podman push ${QUAY_HOSTNAME}/olleb/kafka:3.1.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the image has been successfully pushed into our Quay repository by checking that the image is listed.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/image-pushed.png" alt="image pushed">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="imglayers"><a class="anchor" href="#imglayers"></a>Inspecting image layers</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Navigate to the <code>olleb/kafka</code> repository.</p>
</li>
<li>
<p>Click on the <code>Tags</code> icon.</p>
</li>
<li>
<p>Click on the <code>SHA256</code> value under <code>MANIFEST</code> section of the <code>3.1.0</code> tag to view the layers dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/image-pushed.png" alt="image pushed">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/img-layers.png" alt="img layers">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pull"><a class="anchor" href="#pull"></a>Pull an image from the repository</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>From the Quay dashboard, locate and select the <code>olleb/kafka</code> repository.</p>
</li>
<li>
<p>Click on the <code>Tags</code> tab.</p>
</li>
<li>
<p>Select any of the repository's tags by clicking on it, click on the <code>Fetch Tag</code> icon.</p>
</li>
<li>
<p>Select <code>Docker Pull (by tag)</code> from the <code>Image Format</code> drop-down menu and click on the <code>Copy Command</code> button.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/fetchtag.png" alt="fetchtag">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to a terminal, paste the command you copied from the Quay UI, and then execute it. Make sure you have Docker or podman installed on your system.. If you are using podman, replace <code>docker</code> by <code>podman</code> before execute the command.
Since we created the repository as <code>Public</code>, no login is required to pull the image.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rollback"><a class="anchor" href="#rollback"></a>Image rollback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quay provides us with a convenient way to review the history of tags associated with an image repository.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new image repository as already explained. In this case, create a public repository named <code>olleb/rollback</code> on Quay.</p>
</li>
<li>
<p>Build an image, tag it and push it.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "FROM scratch" &gt; Containerfile.rbk
podman build . -t rollback:1.0 -f Containerfile.rbk

podman tag localhost/rollback:1.0 ${QUAY_HOSTNAME}/olleb/rollback:latest
podman push ${QUAY_HOSTNAME}/olleb/rollback:latest</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the image has been pushed into Quay repository. Check also the manifest digest and the layers.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/rblatest1.png" alt="rblatest1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/rblayers1.png" alt="rblayers1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a new layer to the Containerfile, rebuild the image, and <strong>overwrite</strong> the old one by tagging and pushing it with the same remote tag.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "LABEL org.opencontainers.image.authors=<a href="mailto:angel@olleb.com">angel@olleb.com</a>" &gt;&gt; Containerfile.rbk
podman build . -t rollback:2.0 -f Containerfile.rbk

podman tag localhost/rollback:2.0 ${QUAY_HOSTNAME}/olleb/rollback:latest
podman push ${QUAY_HOSTNAME}/olleb/rollback:latest</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that the new image has been pushed to the Quay repository and check its manifest digest and layers in the Quay UI. You should observe that the manifest digest and layers are different from the previous image.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/rblatest2.png" alt="rblatest2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/rblayers2.png" alt="rblayers2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To rollback the image to the previous one, navigate to the Quay UI and click on the <code>Tag History</code> option for the repository. From there, select the tag for the previous image that you want to rollback to.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/taghistory.png" alt="taghistory">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Revert to &#8230;&#8203;</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/revert.png" alt="revert">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Restore Tag</code> button. This will restore the image for that tag to the previous image.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/restoretag.png" alt="restoretag">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To verify that the image has been restored to the previous one in the tag history, go to the <code>Tag History</code> section in the Quay UI and check that the restored tag has the same manifest digest and layers as the previous image that was reverted to.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/restored.png" alt="restored">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expiration"><a class="anchor" href="#expiration"></a>Image expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure an image tag to expire from Quay on a specific time and date, follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new image repository as already explained. I created the <code>olleb/expiration</code> repository.</p>
</li>
<li>
<p>Build a <code>1.0</code> image, tag it and push it to the <code>olleb/expiration</code> repository.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "FROM scratch" &gt; Containerfile.exp
podman build . -t exp:1.0 -f Containerfile.exp

podman tag localhost/exp:1.0 ${QUAY_HOSTNAME}/olleb/expiration:1.0
podman push ${QUAY_HOSTNAME}/olleb/expiration:1.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The label <code>quay.expires-after</code> is used to indicate the expiration time for the tag. The value of the label can be specified in a number of different formats, including a specific time and date, a relative time offset from the time of image creation, or a relative time offset from the time of tag creation. In this case, we will use the relative time offset of <code>5m</code>, which specifies that the image should expire 5 minutes after it is tagged with the <code>2.0</code> and latest <code>tags</code>.</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "LABEL org.opencontainers.image.authors=<a href="mailto:angel@olleb.com">angel@olleb.com</a>" &gt;&gt; Containerfile.exp
echo "LABEL quay.expires-after=5m" &gt;&gt; Containerfile.exp
podman build . -t exp:2.0 -f Containerfile.exp

podman tag localhost/exp:2.0 ${QUAY_HOSTNAME}/olleb/expiration:2.0
podman push ${QUAY_HOSTNAME}/olleb/expiration:2.0

podman tag localhost/exp:2.0 ${QUAY_HOSTNAME}/olleb/expiration:latest
podman push ${QUAY_HOSTNAME}/olleb/expiration:latest</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>We now have two images and three tags in our <code>olleb/expiration</code> repository. The <code>1.0</code> image has a <code>1.0</code> tag, the <code>2.0</code> image has <code>2.0</code> and <code>latest</code> tags. The <code>latest</code> and the <code>2.0</code> tag are marked as expiring soon.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/exp1.png" alt="exp1">
</div>
</div>
<div class="paragraph">
<p>After 5 minutes, both tags will be removed from the repository automatically.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/taghistoryautodeleted.png" alt="taghistoryautodeleted">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <code>1.0</code> tag, in the <code>Actions</code> drop-down list, select <code>Change Tags Expiration</code>. Set the desired <code>Expiration Date</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/expirationdatetag.png" alt="expirationdatetag">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alternatively, the expiration can also be set by clicking on the <code>Options</code> icon and selecting <code>Change Expiration</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the tag is about to expire, a message will be displayed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/abouttoexpire.png" alt="abouttoexpire">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the minimum expiration time is one hour and the maximum is 104 weeks (approximately 2 years) at the time of this writing. If you want to allow for earlier or later minimum expiration times, you can set the <code>LABELED_EXPIRATION_MINIMUM</code> property to a different time value, such as <code>60s</code> (seconds), <code>5m</code> (minutes), <code>24h</code> (hours), <code>7d</code> (days), or <code>2w</code> (weeks). This configuration must be placed in the <code>Config Bundle Secret</code> of your registry instance. An example of how to do this is explained in section <a href="quay-oci.html#allowed" class="xref page">2.5.1 Configuring allowed OCI artifact types</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the tag expires, it is deleted automatically.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/tagexpireddeleted.png" alt="tagexpireddeleted">
</div>
</div>
<div class="paragraph">
<p>Note that even though the tag is deleted, we can still restore the image. The reason is that when a tag is deleted and there are no other tags pointing to the same image, the image is not immediately deleted. Instead, it is marked for garbage collection, which by default occurs after 14 days (<code>2w</code>). Quay has a garbage collection worker enabled by default which runs periodically and removes the expired images when the configured <strong>Time Machine</strong> amount of time has passed.</p>
</div>
<div class="paragraph">
<p>As we stored the image inside <code>olleb</code> organization, we can check that value by browsing to <code>/organization/olleb?tab=settings</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/orgexptime.png" alt="orgexptime">
</div>
</div>
<div class="paragraph">
<p>If the image stored is under the user account instead on an organization, the value can be found under user settings</p>
</div>
<div class="paragraph">
<p>The Time Machine amount time can be modified by changing the value of the <code>TAG_EXPIRATION_OPTIONS</code> array property, which must include the default expiration value <code>DEFAULT_TAG_EXPIRATION</code> in the list. An example of how to modify this value is explained in section <a href="quay-oci.html#allowed" class="xref page">2.5.1 Configuring allowed OCI artifact types</a>.</p>
</div>
<div class="paragraph">
<p>For example, with the following custom configuration:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/expcfg.png" alt="expcfg">
</div>
</div>
<div class="paragraph">
<p>we will see:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/repositories/customtm.png" alt="customtm">
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="quay-orgs.html">2.1 Users and Organizations</a></span>
  <span class="next"><a href="quay-mirror.html">2.3 Quay Repository Mirroring</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
