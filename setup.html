<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Prerequisites :: Red Hat Quay Workshop</title>
    <link rel="canonical" href="https://olleb.com/quay-workshop/setup.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="quay-orgs.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/quay-workshop">Red Hat Quay Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#odf">ODF Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#storage">Creating the ODF Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#quayoperator">Installing the Quay Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#quayinstance">Deploying Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exportenvvar">Exporting Environment Variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#trustedca">Adding the Quay Certificate as a Trusted CA in OCP (Optional)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#keycloak">Installing Red Hat build of Keycloak (Optional)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-orgs.html">Users and Organizations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-orgs.html#useraccounts">Creating User Accounts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-orgs.html#orgaccounts">Creating Organization Accounts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-repos.html">Repository Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#imagerepo">Creating an Image Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#push">Pushing and Tagging an Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#imglayers">Inspecting Image Layers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#pull">Pulling an Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#rollback">Rolling Back an Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repos.html#expiration">Image Expiration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-mirror.html">Repository Mirroring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-mirror.html#imagerepo">Creating a Mirrored Repository</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-mirror.html#usage">Repository Usage Logs, Tags, and Tag History</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-repo-notifications.html">Repository Notifications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-repo-notifications.html#pushnotif">Creating a Push-to-Repository Event Notification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html">OCI-Based Artifacts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-oci.html#helm">Working with Helm Charts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html#signed">Signed Container Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#cosign">Signing Container Images with Cosign</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#signpgp">Signing Container Images with PGP (RFC4880)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-oci.html#encrypted">Encrypted Container Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#jwe">Encrypting Container Images with JSON Web Encryption (JWE) (RFC7516)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-oci.html#pgp">Encrypting Container Images with PGP (RFC4880)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-clair.html">Security Scanning (Clair)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-clair.html#cve">Exploring Vulnerability Data (CVEs)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-clair.html#secscan">Performing a Security Scan</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="quay-clair.html#packages">Viewing Packages</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-cso.html">Container Security Operator (CSO)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-cso.html#install">Installing the Quay CSO Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-cso.html#vulncheck">Checking Image Vulnerabilities from the OpenShift Web Console</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quay-obs.html">Observability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-keycloak.html">Quay Integration with Keycloak (OpenID Connect)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-keycloak.html#keycloakconfig">Configuring Keycloak for Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-keycloak.html#quayconfig">Configuring Quay to Use Keycloak as an OpenID Provider</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-keycloak.html#testlogin">Testing OpenID Login</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quay-troubleshooting.html">Troubleshooting and Tips</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-troubleshooting.html#tls">TLS and Insecure Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-troubleshooting.html#cosign">cosign and Registry Trust Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay-troubleshooting.html#gpg">GPG Key Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Quay Workshop</a></li>
    <li><a href="setup.html">Prerequisites</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://olleb.com" target="_blank" rel="noopener noreferrer"> © 2025 - Àngel Ollé Blázquez</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Prerequisites</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tutorial was developed and tested with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift <code>4.19.8</code></p>
</li>
<li>
<p>Red Hat Quay <code>3.15</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following tools are required to run the exercises in this tutorial. Please ensure that they are installed and properly configured before proceeding with any of the tutorial chapters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Tool</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reference</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>podman</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://podman.io/getting-started/installation">Podman Installation Instructions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skopeo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/containers/skopeo/blob/main/install.md">Installing Skopeo</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Red Hat OpenShift CLI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://access.redhat.com/downloads/content/290">OpenShift Container Platform downloads page</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>helm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://helm.sh/docs/intro/install">Installing Helm</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openssl</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cosign</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.sigstore.dev/cosign/system_config/installation/">cosign Installation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pgp</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note: Some of these tools are also available through the web terminal provided by the operator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="odf"><a class="anchor" href="#odf"></a>ODF Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install OpenShift Data Foundation Operator by following these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a browser window and log in to the Red Hat OpenShift Container Platform web console.</p>
</li>
<li>
<p>From the <strong>Administrator</strong> perspective, click <code>Operators</code>, and then select <code>OperatorHub</code>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> field, type <code>ODF</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/operatorhub-odf.png" alt="operatorhub odf">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the Red Hat OpenShift Data Foundation tile and click the <code>Install</code> button.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odf-install.png" alt="odf install">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the <strong>Install Operator</strong> page, select <code>stable-4.19</code> from the list of available <strong>Update Channel</strong> options, and then choose <strong>A specific namespace on the cluster</strong>. Leave the default value for <strong>Installed Namespace</strong> as <code>openshift-storage</code>, and set <strong>Update Approval</strong> to <code>Automatic</code>. Also, make sure to enable the console plug-in.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odfoperator-install-opts.png" alt="odfoperator install opts">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Install</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage"><a class="anchor" href="#storage"></a>Creating the ODF Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Deploy an OpenShift Data Foundation (ODF) <code>StorageCluster</code> using the OpenShift web console.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the <strong>Administrator</strong> perspective in the OpenShift console, navigate to <code>Storage</code> &gt; <code>Data Foundation</code>.</p>
</li>
<li>
<p>Go to the <strong>Storage System</strong> tab.</p>
</li>
<li>
<p>Click <code>Create StorageSystem</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odf1.png" alt="odf1">
</div>
</div>
<div class="paragraph">
<p>Select the backing storage type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the first page of the wizard (<strong>Backing storage</strong>), select <code>Use an existing StorageClass</code>. For example, <code>gp3-csi</code>.</p>
</li>
<li>
<p>Click <code>Next</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odf2.png" alt="odf2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the desired capacity and nodes.</p>
</li>
<li>
<p>Click <code>Next</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odf3.png" alt="odf3">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Leave the default options for <strong>Security and network</strong> and <strong>Review and create</strong>. Then click <code>Next</code> and <code>Create StorageSystem</code>, respectively.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/odf4.png" alt="odf4">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wait until the OpenShift Data Foundation components are fully deployed before proceeding.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quayoperator"><a class="anchor" href="#quayoperator"></a>Installing the Quay Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Subscribe to and deploy the <code>Red Hat Quay Operator</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a browser window and log in to the Red Hat OpenShift Container Platform web console.</p>
</li>
<li>
<p>From the <strong>Administrator</strong> perspective, click <code>Operators</code>, and then select <code>OperatorHub</code>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> field, type <code>Red Hat Quay</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/operatorhub-quay.png" alt="operatorhub quay">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the Red Hat Quay tile and click the <code>Install</code> button.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/quayoperator-install.png" alt="quayoperator install">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the <strong>Install Operator</strong> page, select <code>stable-3.15</code> from the list of available <strong>Update Channel</strong> options. Then, choose <code>All namespaces on the cluster (default)</code> as the installation mode and select <code>Automatic</code> for update approval.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/quayoperator-opts.png" alt="quayoperator opts">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Install</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quayinstance"><a class="anchor" href="#quayinstance"></a>Deploying Quay</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Create a new project named <code>quay-workshop</code>.</p>
</li>
<li>
<p>From the <strong>Administrator</strong> perspective, navigate to <code>Operators</code>, and then select <code>Installed Operators</code>. Choose the <code>quay-workshop</code> project and select the Red Hat Quay Operator.</p>
</li>
<li>
<p>Click <code>Create instance</code> to create a new Quay registry instance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/create-quay-instance.png" alt="create quay instance">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If desired, change the name, and then click <code>Create</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/quay-create.png" alt="quay create">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exportenvvar"><a class="anchor" href="#exportenvvar"></a>Exporting Environment Variables</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is recommended to set the <code>QUAY_HOSTNAME</code> environment variable in the working terminal before running the commands. Alternatively, you can specify the hostname directly within the commands as needed.
</td>
</tr>
</table>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">QUAY_HOSTNAME=$(oc get route registry-quay -n quay-workshop -o jsonpath={.spec.host})</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trustedca"><a class="anchor" href="#trustedca"></a>Adding the Quay Certificate as a Trusted CA in OCP (Optional)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This step is recommended if your Quay registry uses a self-signed or internal certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the Quay registry certificate:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo -n | openssl s_client -showcerts -connect $QUAY_HOSTNAME:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' &gt; quay.crt</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a ConfigMap containing the CA:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -n openshift-config configmap quay-ca --from-file=$QUAY_HOSTNAME=quay.crt

# Verify
oc get -n openshift-config configmap quay-ca -o yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Associate the CA with the cluster:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc patch image.config.openshift.io/cluster --type=merge -p '{"spec":{"additionalTrustedCA":{"name":"quay-ca"}}}'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get image.config.openshift.io/cluster -o yaml</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="keycloak"><a class="anchor" href="#keycloak"></a>Installing Red Hat build of Keycloak (Optional)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This step is <strong>optional</strong> and only required if you plan to configure <strong>Quay authentication with Keycloak via OpenID Connect</strong>.</p>
</div>
<div class="paragraph">
<p>In this section, you will deploy Red Hat build of Keycloak on OpenShift.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a browser window and log in to the Red Hat OpenShift Container Platform web console.</p>
</li>
<li>
<p>From the Administrator perspective, click <code>Operators</code>, then <code>OperatorHub</code>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> field, type <code>rhbk</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/operatorhub-rhbk.png" alt="operatorhub rhbk">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <code>Keycloak Operator</code> tile and click <strong>Install</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/install-rhbk-operator.png" alt="install rhbk operator">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the <strong>Install Operator</strong> page, keep the <code>stable-v22</code> option from the list of available <strong>Update Channels</strong>.
The Operator only supports the installation mode <strong>A specific namespace on the cluster</strong>.
Create the <code>rhbk</code> project and choose <strong>Automatic</strong> update approval.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/rhbk-operator-opts.png" alt="rhbk operator opts">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Install</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once installed, the <code>Keycloak Operator</code> will appear in the list of installed operators under <strong>Operators</strong> → <strong>Installed Operators</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/rhbk-operator-installed.png" alt="rhbk operator installed">
</div>
</div>
<div class="paragraph">
<p>Keycloak requires several prerequisites (unless running in <code>start-dev</code> mode), which we will now install and configure.</p>
</div>
<div class="paragraph">
<p>We will set up a PostgreSQL database for this workshop.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the database instance:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk apply -f <a href="https://raw.githubusercontent.com/aolle/quay-workshop/main/manifests/postgres.yaml" class="bare">https://raw.githubusercontent.com/aolle/quay-workshop/main/manifests/postgres.yaml</a></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the secrets:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk create secret generic keycloak-db-secret \
  --from-literal=username=keycloak \
  --from-literal=password=keycloak</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The YAML file already includes the <code>keycloak</code> database credentials, which is acceptable for workshop purposes.
In production, these values must be securely defined and stored in a secret.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a self-signed certificate:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openssl req -subj '/CN=&lt;YOUR_KEYCLOAK_HOSTNAME&gt;/O=Keycloak/C=ES' -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem

openssl req \
  -newkey rsa:2048 -nodes \
  -keyout key.pem \
  -x509 -days 365 \
  -out certificate.pem \
  -subj "/CN=&lt;KEYCLOAK_HOSTNAME&gt;/O=Keycloak/C=ES" \
  -addext "subjectAltName=DNS:&lt;KEYCLOAK_HOSTNAME&gt;"

oc create secret -n rhbk tls keycloak-tls-secret --cert=certificate.pem --key=key.pem</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the Red Hat build of Keycloak instance:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk apply -f <a href="https://raw.githubusercontent.com/aolle/quay-workshop/main/manifests/keycloak.yaml" class="bare">https://raw.githubusercontent.com/aolle/quay-workshop/main/manifests/keycloak.yaml</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>After deploying and confirming that the Keycloak instance is running successfully, retrieve the automatically generated admin credentials:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n rhbk get secret keycloak-initial-admin -o jsonpath='{.data.username}' | base64 --decode
oc -n rhbk get secret keycloak-initial-admin -o jsonpath='{.data.password}' | base64 --decode</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In production, always change the default credentials and enable multi-factor authentication.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the administration console using the retrieved credentials.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/install/admin-console.png" alt="admin console">
</div>
</div>
<div class="paragraph">
<p>Add the CA as a trusted certificate in Quay:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Encode the certificate in Base64:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">base64 certificate.pem -w 0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the output; it will be used in the next step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Secret containing Quay&#8217;s configuration is located in the <code>quay-workshop</code> namespace.
Its name starts with <code>registry-config-bundle-</code> followed by a random suffix generated by the operator.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to the OpenShift web console.</p>
</li>
<li>
<p>Navigate to the namespace where your QuayRegistry is deployed (e.g. <code>quay-workshop</code>):</p>
<div class="literalblock">
<div class="content">
<pre>Operators → Installed Operators → Red Hat Quay → Quay Registries</pre>
</div>
</div>
</li>
<li>
<p>Click on your target QuayRegistry instance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/rhbk/rhbk11.png" alt="rhbk11">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Resources</strong> tab, locate the configuration bundle Secret.
The name typically begins with <code>registry-config-bundle-</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/rhbk/rhbk12.png" alt="rhbk12">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the Secret and select the <strong>YAML</strong> tab.</p>
</li>
<li>
<p>Add or replace the key <code>extra_ca_cert_certificate_rhbk</code> under the <code>data</code> section:</p>
</li>
</ul>
</div>
<div class="paragraph lines_space">
<p>[.console-input]c</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Secret
apiVersion: v1
metadata:
&lt;..&gt;
data:
  config.yaml: QUxMT1dfUFVMTFN..
  extra_ca_cert_certificate_rhbk: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0..
type: Opaque
&lt;..&gt;</code></pre>
</div>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="rhbk/rhbk20.png" alt="rhbk20">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Save the changes using the <strong>Save</strong> button.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Red Hat Quay Workshop</a></span>
  <span class="next"><a href="quay-orgs.html">Users and Organizations</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
